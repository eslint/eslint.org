---
/**
 * @fileoverview Header component with navigation
 * @author ESLint
 */
import type { Locale } from "../i18n";
import { getSiteData } from "../i18n";
import { getLinks } from "../utils/data";
import { getLinkActiveState } from "../utils/helpers";
import Logo from "./Logo.astro";

interface Props {
	locale: Locale;
}

const { locale } = Astro.props;
const site = getSiteData(locale);
const links = getLinks();

const navigation = site.navigation as Array<{
	text: string;
	link: string;
	target?: string;
}>;
const donatePage = site.donate_page as { title: string };
const currentPath = Astro.url.pathname;

// Helper to get the appropriate link URL
function getNavLink(linkKey: string): string {
	const link = links[linkKey] || `/${linkKey}`;
	// For internal links, add the locale prefix
	if (link.startsWith("/")) {
		return `/${locale}${link}`;
	}
	return link;
}
---

<header class="site-header">
	<div class="content-container">
		<a href={`/${locale}/`} aria-label="Homepage" class="logo-link">
			<Logo />
		</a>
		<nav class="site-nav" aria-label="Main">
			<div class="flexer">
				<a
					href={`/${locale}${links.donate}`}
					class="c-btn c-btn--primary donate-link"
				>
					{donatePage.title}
				</a>
				<button
					class="site-nav-toggle"
					aria-label="Menu"
					id="nav-toggle"
					aria-controls="nav-list"
				>
					<svg width="20" height="20" viewBox="20 20 60 60">
						<path
							id="ham-top"
							d="M30,37 L70,37 Z"
							stroke="currentColor"></path>
						<path
							id="ham-middle"
							d="M30,50 L70,50 Z"
							stroke="currentColor"></path>
						<path
							id="ham-bottom"
							d="M30,63 L70,63 Z"
							stroke="currentColor"></path>
					</svg>
				</button>
			</div>
			<ul id="nav-list">
				{
					navigation.map(item => {
						const itemLink = getNavLink(item.link);
						const activeState = getLinkActiveState(itemLink, currentPath);
						return (
							<li>
								<a
									href={itemLink}
									set:html={activeState ? `${activeState}` : undefined}
									{...(activeState.includes('aria-current')
										? { "aria-current": "page" }
										: {})}
									{...(activeState.includes('data-current')
										? { "data-current": "true" }
										: {})}
									{...(item.target ? { target: item.target } : {})}
								>
									{item.text}
								</a>
							</li>
						);
					})
				}
			</ul>
		</nav>
	</div>
</header>
